{"ast":null,"code":"import _regeneratorRuntime from\"D:/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectWithoutProperties from\"D:/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"serverResWithError\",\"handleNewUserData\",\"onLoggedIn\"];import{userContex}from'../../../contexts/CurrentUserContext';import'./Profile.css';import{React,useContext,useMemo,useState}from'react';import{useNavigate}from'react-router-dom';import{useFormWithValidation}from'../../Validate/Validate';import{pattern}from'../../../utils/constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Profile(_ref){var serverResWithError=_ref.serverResWithError,handleNewUserData=_ref.handleNewUserData,onLoggedIn=_ref.onLoggedIn,props=_objectWithoutProperties(_ref,_excluded);var navigate=useNavigate();var currentUser=useContext(userContex);var _useState=useState({message:'',isDisabled:false}),_useState2=_slicedToArray(_useState,2),waitingResponse=_useState2[0],setWaitingResponse=_useState2[1];var _useFormWithValidatio=useFormWithValidation({name:currentUser.name,email:currentUser.email}),values=_useFormWithValidatio.values,handleChange=_useFormWithValidatio.handleChange,errors=_useFormWithValidatio.errors,isValid=_useFormWithValidatio.isValid;var isChanged=useMemo(function(){return currentUser.name!==values.name||currentUser.email!==values.email;},[currentUser,values.name,values.email]);function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}// После выхода отрабатывается функция\nfunction _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(evt){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:evt.preventDefault();_context.prev=1;setWaitingResponse({isDisabled:true});_context.next=5;return handleNewUserData(values.name,values.email);case 5:setWaitingResponse({message:'Данные успешно сохраненны',isDisabled:true});case 6:_context.prev=6;setTimeout(function(){setWaitingResponse({message:'',isDisabled:false});},3500);return _context.finish(6);case 9:case\"end\":return _context.stop();}},_callee,null,[[1,,6,9]]);}));return _handleSubmit.apply(this,arguments);}var outSite=function outSite(){localStorage.clear();onLoggedIn(false);navigate('/');};return/*#__PURE__*/_jsx(\"section\",{className:\"profile\",children:/*#__PURE__*/_jsx(\"div\",{className:\"profile__container\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"profile__form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile__form_container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"profile__greeting\",children:\"\".concat(props.greeting,\", \").concat(currentUser.name,\"!\")}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__form-list-inputs_container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"profile__span \".concat(!errors?\"\":\"profile__span_type_input_error\"),children:errors.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__form-input_container\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"profile__form-label\",children:\"\\u0418\\u043C\\u044F\"}),/*#__PURE__*/_jsx(\"input\",{className:\"profile__form-input profile__form_user_name\",name:\"name\",id:\"input-name\",type:\"text\",placeholder:\"\\u0412\\u0430\\u0448\\u0435 \\u0438\\u043C\\u044F\",value:values.name||'',onChange:handleChange,minLength:2,maxLength:30,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__form-input_container\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"profile__form-label\",children:\"E-mail\"}),/*#__PURE__*/_jsx(\"input\",{className:\"profile__form-input profile__form_user_email\",name:\"email\",id:\"input-email\",type:\"email\",placeholder:\"\\u0412\\u0430\\u0448\\u0430 \\u043F\\u043E\\u0447\\u0442\\u0430\",value:values.email||'',onChange:handleChange,pattern:pattern,required:true})]}),/*#__PURE__*/_jsx(\"span\",{className:\"profile__span \".concat(!errors?\"\":\"profile__span_type_input_error\"),children:errors.email})]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"profile__span \".concat(!serverResWithError||waitingResponse.isDisabled?waitingResponse.message?\"profile__span-successful_type_profile\":\"\":\"profile__span_type_profile\"),children:serverResWithError.message||waitingResponse.message}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__form-btn_container\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:waitingResponse.isDisabled||!isChanged||!isValid,className:\"profile__btn profile__btn-form \".concat(waitingResponse.isDisabled||!isChanged||!isValid?'profile__btn-form_disabled':''),children:props.btnEditText}),/*#__PURE__*/_jsx(\"button\",{onClick:outSite,type:\"button\",className:\"profile__btn profile__btn-exit\",children:props.btnExitText})]})]})})});}export default Profile;","map":{"version":3,"names":["userContex","React","useContext","useMemo","useState","useNavigate","useFormWithValidation","pattern","jsx","_jsx","jsxs","_jsxs","Profile","_ref","serverResWithError","handleNewUserData","onLoggedIn","props","_objectWithoutProperties","_excluded","navigate","currentUser","_useState","message","isDisabled","_useState2","_slicedToArray","waitingResponse","setWaitingResponse","_useFormWithValidatio","name","email","values","handleChange","errors","isValid","isChanged","handleSubmit","_x","_handleSubmit","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","evt","wrap","_callee$","_context","prev","next","preventDefault","setTimeout","finish","stop","outSite","localStorage","clear","className","children","onSubmit","concat","greeting","id","type","placeholder","value","onChange","minLength","maxLength","required","disabled","btnEditText","onClick","btnExitText"],"sources":["D:/dev/movies-explorer-frontend/src/components/Authorization/Profile/Profile.js"],"sourcesContent":["import { userContex } from '../../../contexts/CurrentUserContext';\r\n\r\nimport './Profile.css';\r\nimport { React, useContext, useMemo, useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useFormWithValidation } from '../../Validate/Validate';\r\nimport { pattern } from '../../../utils/constants';\r\n\r\nfunction Profile({ serverResWithError, handleNewUserData, onLoggedIn, ...props }) {\r\n    const navigate = useNavigate();\r\n    const currentUser = useContext(userContex);\r\n    const [waitingResponse, setWaitingResponse] = useState({\r\n        message: '',\r\n        isDisabled: false,\r\n    });\r\n    const { values, handleChange, errors, isValid } = useFormWithValidation({\r\n        name: currentUser.name,\r\n        email: currentUser.email,\r\n    });\r\n\r\n    const isChanged = useMemo(() => {\r\n        return currentUser.name !== values.name || currentUser.email !== values.email\r\n    }, [currentUser, values.name, values.email])\r\n\r\n    async function handleSubmit(evt) {\r\n        evt.preventDefault();\r\n\r\n        try {\r\n            setWaitingResponse({\r\n                isDisabled: true,\r\n            });\r\n            await handleNewUserData(values.name, values.email);\r\n            setWaitingResponse({\r\n                message: 'Данные успешно сохраненны',\r\n                isDisabled: true,\r\n            });\r\n        } finally {\r\n            setTimeout(() => {\r\n                setWaitingResponse({\r\n                    message: '',\r\n                    isDisabled: false,\r\n                });\r\n            }, 3500);\r\n        }\r\n    }\r\n\r\n    // После выхода отрабатывается функция\r\n    const outSite = () => {\r\n        localStorage.clear();\r\n        onLoggedIn(false);\r\n        navigate('/');\r\n    }\r\n\r\n    return (\r\n        <section className='profile'>\r\n\r\n            <div className='profile__container'>\r\n\r\n                <form onSubmit={handleSubmit} className='profile__form'>\r\n                    <div className='profile__form_container'>\r\n                        <h2 className='profile__greeting'>{`${props.greeting}, ${currentUser.name}!`}</h2>\r\n                        <div className='profile__form-list-inputs_container'>\r\n                            <span className={`profile__span ${!errors ? \"\" : \"profile__span_type_input_error\"}`}\r\n                            >{errors.name}</span>\r\n                            <div className='profile__form-input_container'>\r\n                                <label className='profile__form-label'>Имя</label>\r\n                                <input className='profile__form-input profile__form_user_name' name='name' id='input-name' type='text' placeholder='Ваше имя' value={values.name || ''} onChange={handleChange} minLength={2} maxLength={30} required />\r\n                            </div>\r\n                            <div className='profile__form-input_container'>\r\n                                <label className='profile__form-label'>E-mail</label>\r\n                                <input className='profile__form-input profile__form_user_email' name='email' id='input-email' type='email' placeholder='Ваша почта' value={values.email || ''} onChange={handleChange} pattern={pattern} required />\r\n                            </div>\r\n                            <span className={`profile__span ${!errors ? \"\" : \"profile__span_type_input_error\"}`}\r\n                            >{errors.email}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <span\r\n                        className={\r\n                            `profile__span ${!serverResWithError || waitingResponse.isDisabled\r\n                                ? waitingResponse.message\r\n                                    ? \"profile__span-successful_type_profile\"\r\n                                    : \"\"\r\n                                : \"profile__span_type_profile\"}`\r\n                        }\r\n                    >\r\n                        {serverResWithError.message || waitingResponse.message}\r\n                    </span>\r\n                    <div className='profile__form-btn_container'>\r\n                        <button type='submit' disabled={waitingResponse.isDisabled || !isChanged || !isValid} className={`profile__btn profile__btn-form ${waitingResponse.isDisabled || !isChanged || !isValid\r\n                            ? 'profile__btn-form_disabled'\r\n                            : ''}`}\r\n                        >{props.btnEditText}</button>\r\n                        <button onClick={outSite} type='button' className='profile__btn profile__btn-exit'>{props.btnExitText}</button>\r\n                    </div>\r\n                </form>\r\n\r\n            </div>\r\n\r\n        </section>\r\n    )\r\n}\r\n\r\nexport default Profile"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}